(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.xMarkdown=t()})(this,function(){"use strict";const e="\n",t="\t";var n={version:"1.0"};return n.action={bold:{action(e){this.insert(e,"**{0}**",""===e?-2:0)},key:"Ctrl-B"},italic:{action(e){this.insert(e,"*{0}*",""===e?-1:0)},key:"Ctrl-I"},link:{action(e){this.insert(e,"[{0}]()",-1)},key:"Ctrl-K"},image:{action(e){this.insert(e,"![]({0})")},key:"Ctrl-Alt-I"},list:{action(t){var n=t.split(e),i=n.length;if(1===i)this.insert("- ");else{for(var l=0;l<i;l++)0===n[l].indexOf("- ")?n[l]=n[l].substr(2):n[l]=n[l].trim()?"- "+n[l]:"";this.insert(n.join(e))}},key:"Ctrl-L"},underline:{action(e){this.insert(e,"~~{0}~~",""===e?-2:0)},key:"Ctrl-U"},code:{action(e){this.insert(e,"`{0}`",""===e?-1:0)},key:null},codeblock:{action(t){this.insert(t,e+"```"+e+"{0}"+e+"```"+e,""===t?-5:0)},key:"Ctrl-Alt-C"},table:{action(){this.insert("| th | th |"+e+"| --- | --- |"+e+"| td | td |")},key:"Ctrl-Alt-T"},header:{action(e,t){t=~~t,t=t>0&&t<7?t:1,this.insert(e,"#".repeat(t)+" {0}")},key:"Ctrl-H"},quote:{action(e){this.insert(e,"> {0}")},key:"Ctrl-Q"}},n.create=(i=>{var l={};return i="string"==typeof i?document.querySelector(i):i,null===i||"object"!=typeof i||1!==i.nodeType||"TEXTAREA"!==i.nodeName?(console.error("No textarea element found"),l):(l.el=i,l.insert=function(e,t,n){e=t?t.replace("{0}",e):e,this.el.setRangeText(e,this.el.selectionStart,this.el.selectionEnd,"end"),this.el.selectionEnd+=~~n},l.selectionText=function(){return this.el.value.substring(this.el.selectionStart,this.el.selectionEnd)},l.focus=function(){this.el.focus()},l.action=function(e,t,i){e in n.action&&(n.action[e].action.call(this,t,i),this.focus())},l.blur=function(){this.el.blur()},l.enable=function(e){l.el.disabled=!!e},l.cursor=function(){var t=this.el.value.split(e),n=[],i=1,l=0,s=0,o={start:this.el.selectionStart,end:this.el.selectionEnd},r=0;return t.forEach(function(t){l=s,s+=t.length+1,o.start>=l&&o.end<=s&&(r=i-1),n.push({value:t+e,len:t.length,start:l,end:s}),i++}),o.text=n[r].value,o.lines=n,o.line=r,o},l.value=function(e){if("string"!=typeof e)return this.el.value;this.el.value=e},l.el.addEventListener("keydown",function(i){if(9===i.keyCode){i.preventDefault();for(var s=l.selectionText(),o=s.split(e),r=o.length,c=0;c<r;c++)i.shiftKey?o[c]=o[c].replace(/(^\t+)|(^(\-|\*) )/,function(e){return e.substr(0===e.indexOf("-")||0===e.indexOf("* ")?2:1)}):o[c]=t+o[c];s=o.join(e),l.el.setRangeText(s,l.el.selectionStart,l.el.selectionEnd,r>1?"select":"end")}else if(13===i.keyCode){if(i.shiftKey)return;var a=l.cursor(),u=a.text.match(/^((\t*)((\-|\*) )*)/);""!==u[0]&&setTimeout(function(){l.insert(u[0])},1)}for(let e of Object.values(n.action)){if(!e.key)continue;let t=e.key.split("-");i.key.toUpperCase()===t.at(-1)&&((-1===t.indexOf("Ctrl")||i.ctrlKey)&&(-1===t.indexOf("Alt")||i.altKey)&&(-1===t.indexOf("Shift")||i.shiftKey)&&(e.action.call(l,l.selectionText()),l.focus(),i.preventDefault()))}}),l)}),n});